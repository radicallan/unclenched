<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixel Plaza â€” Guaranteed Fit</title>
  <style>
    :root{ --bg:#0b0d12; --panel:#141826; --line:#20283a; --ink:#eef1ff; --muted:#9aa2b8; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{display:grid;grid-template-rows:auto 1fr auto}
    header{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#0f1220,#0b0f1a)}
    .logo{font-weight:900;letter-spacing:.4px;background:linear-gradient(90deg,#ffd166,#fb8500,#ffb703);-webkit-background-clip:text;background-clip:text;color:transparent}
    .toolbar{margin-left:auto;display:flex;gap:8px}
    .btn{background:var(--panel);border:1px solid var(--line);color:var(--ink);padding:8px 10px;border-radius:10px;font-weight:600;cursor:pointer}
    .seg{display:inline-flex;background:var(--panel);border:1px solid var(--line);border-radius:10px;overflow:hidden}
    .seg button{all:unset;padding:8px 10px;cursor:pointer}
    .seg button.active{background:#1b2133}

    .room-wrap{position:relative; margin:12px; border:1px solid var(--line); border-radius:16px; overflow:hidden; background:#0f1322; box-shadow:0 10px 30px #0008}
    canvas{display:block;width:100%;height:100%; image-rendering:pixelated}
    .hud{position:absolute; right:8px; bottom:8px; display:flex; gap:8px; z-index:2}
    .pill{background:#111522;border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}

    footer{display:flex;gap:8px;align-items:center;padding:10px 12px;border-top:1px solid var(--line);background:linear-gradient(180deg,#0b0f18,#090c13)}
    footer input{flex:1}
  </style>
</head>
<body>
  <header>
    <div class="logo">PIXEL&nbsp;PLAZA</div>
    <div class="pill">Habboâ€‘style isometric â€” guaranteed to fit</div>
    <div class="toolbar">
      <div class="seg" role="group" aria-label="Zoom">
        <button id="zoomOut" title="Zoom out">âˆ’</button>
        <button id="zoomReset" class="active" title="Reset / Fit">Fit</button>
        <button id="zoomIn" title="Zoom in">+</button>
      </div>
    </div>
  </header>

  <div class="room-wrap" id="wrap">
    <canvas id="room" width="800" height="600" aria-label="Isometric room"></canvas>
    <div class="hud">
      <div class="pill" id="status">Ready</div>
    </div>
    <div id="bubble" class="pill" style="position:absolute;transform:translate(-50%,-160%);display:none">Hi</div>
  </div>

  <footer>
    <input id="chat" placeholder="Say somethingâ€¦ (Enter to send)" />
    <button class="btn" id="send">Send</button>
  </footer>

  <script>
  // ===== Constants =====
  const TILE_W=64, TILE_H=32, TILE_Z=16;
  const gridW=18, gridH=14;

  // ===== Canvas & sizing =====
  const wrap=document.getElementById('wrap');
  const canvas=document.getElementById('room');
  const ctx=canvas.getContext('2d',{alpha:false});
  ctx.imageSmoothingEnabled=false;

  // world state
  let map = Array.from({length:gridH},()=>Array.from({length:gridW},()=>({type:'floor',h:0})));
  function seed(){
    map.forEach(r=>r.forEach(t=>{t.type='floor';t.h=0;}));
    for(let i=0;i<12;i++) map[rand(2,gridH-3)][rand(2,gridW-3)]={type:'plant',h:0};
    for(let i=0;i<8;i++) map[rand(2,gridH-3)][rand(2,gridW-3)]={type:'sofa',h:0};
    for(let x=1;x<gridW-1;x++){ map[2][x]={type:'wall',h:1}; map[gridH-3][x]={type:'wall',h:1}; }
  }
  seed();

  const avatar={ x:Math.floor(gridW/2), y:Math.floor(gridH/2)+2, waving:0, col:'blue', name:'Guest', path:[] };

  // camera transform
  let zoom=1, offX=0, offY=0; // in device pixels

  // helpers
  const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const isoToScreen=(ix,iy,iz)=>({ x:(ix-iy)*TILE_W/2, y:(ix+iy)*TILE_H/2 - iz*TILE_Z });
  const screenToIso=(px,py)=>({ x:(px/(TILE_W/2)+py/(TILE_H/2))/2, y:(py/(TILE_H/2)-px/(TILE_W/2))/2 });

  function worldBounds(){
    let minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;
    for(let y=0;y<gridH;y++){
      for(let x=0;x<gridW;x++){
        const c0=isoToScreen(x,y,0);
        const c1=isoToScreen(x+1,y+1,0);
        if(c0.x<minX)minX=c0.x; if(c0.y<minY)minY=c0.y;
        if(c1.x>maxX)maxX=c1.x; if(c1.y>maxY)maxY=c1.y;
      }
    }
    minY-=140; maxY+=40; minX-=60; maxX+=60; // padding & headroom
    return {minX,minY,maxX,maxY,width:maxX-minX,height:maxY-minY};
  }

  function fit(){
    // size wrapper to viewport first
    const headerH=document.querySelector('header').offsetHeight;
    const footerH=document.querySelector('footer').offsetHeight;
    const h = Math.max(420, window.innerHeight - headerH - footerH - 24);
    wrap.style.height = h + 'px';

    const dpr=window.devicePixelRatio||1;
    const rect=wrap.getBoundingClientRect();
    canvas.width = Math.max(1, Math.floor(rect.width * dpr));
    canvas.height= Math.max(1, Math.floor(rect.height* dpr));

    const b=worldBounds();
    const pad=16*dpr;
    const viewW=canvas.width - pad*2;
    const viewH=canvas.height - pad*2;
    zoom = clamp(Math.min(viewW/b.width, viewH/b.height), 0.5, 3);

    offX = (canvas.width/2) - ((b.minX + b.width/2) * zoom);
    offY = (canvas.height/2) - ((b.minY + b.height/2) * zoom);

    document.getElementById('zoomReset').textContent='Fit';
    draw();
  }

  function toScreen(p){ return { x: p.x*zoom + offX, y: p.y*zoom + offY }; }

  // drawing
  function drawTile(gx,gy,t){
    const base=isoToScreen(gx,gy,t.h); const s=toScreen(base);
    const TW=TILE_W*zoom, TH=TILE_H*zoom;
    // floor
    ctx.fillStyle='#1d2540';
    ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(s.x+TW/2, s.y+TH/2); ctx.lineTo(s.x, s.y+TH); ctx.lineTo(s.x-TW/2, s.y+TH/2); ctx.closePath(); ctx.fill();
    ctx.strokeStyle='#263054'; ctx.stroke();
    // decor
    if(t.type==='wall'){
      const h=32*zoom;
      ctx.fillStyle='#0f1424'; ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(s.x+TW/2, s.y+TH/2); ctx.lineTo(s.x+TW/2, s.y+TH/2-h); ctx.lineTo(s.x, s.y-h); ctx.closePath(); ctx.fill();
      ctx.fillStyle='#131a2e'; ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(s.x-TW/2, s.y+TH/2); ctx.lineTo(s.x-TW/2, s.y+TH/2-h); ctx.lineTo(s.x, s.y-h); ctx.closePath(); ctx.fill();
    }else if(t.type==='sofa'){
      rounded(s.x, s.y-10*zoom, TW*0.6, 24*zoom, '#7d3aa1');
    }else if(t.type==='plant'){
      dot(s.x, s.y-10*zoom, 5*zoom, '#2f7d32');
    }
  }
  function dot(x,y,r,c){ ctx.fillStyle=c; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
  function rounded(cx,cy,w,h,color){ ctx.fillStyle=color; const r=6; ctx.beginPath(); ctx.moveTo(cx-w/2+r, cy-h/2); ctx.arcTo(cx+w/2, cy-h/2, cx+w/2, cy-h/2+r, r); ctx.arcTo(cx+w/2, cy+h/2, cx+w/2-r, cy+h/2, r); ctx.arcTo(cx-w/2, cy+h/2, cx-w/2, cy+h/2-r, r); ctx.arcTo(cx-w/2, cy-h/2, cx-w/2+r, cy-h/2, r); ctx.closePath(); ctx.fill(); }

  function drawAvatar(){
    const t=map[avatar.y]?.[avatar.x]||{h:0}; const base=isoToScreen(avatar.x,avatar.y,t.h); const s=toScreen({x:base.x,y:base.y-8});
    // shadow
    ctx.fillStyle='#00000066'; ctx.beginPath(); ctx.ellipse(s.x, s.y+18*zoom, 10*zoom, 4*zoom, 0, 0, Math.PI*2); ctx.fill();
    // body
    rounded(s.x, s.y-2*zoom, 22*zoom,24*zoom, '#5a79e6');
    rounded(s.x, s.y-8*zoom, 18*zoom,10*zoom, '#86a7ff');
    rounded(s.x, s.y-18*zoom,14*zoom,12*zoom,'#f0d9c2');
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<gridH;y++) for(let x=0;x<gridW;x++) drawTile(x,y,map[y][x]);
    drawAvatar();
  }

  // movement (simple click)
  canvas.addEventListener('click', (e)=>{
    const rect=canvas.getBoundingClientRect();
    const dpr=window.devicePixelRatio||1;
    const px=(e.clientX-rect.left)*dpr, py=(e.clientY-rect.top)*dpr;
    const wx=(px - offX)/zoom; const wy=(py - offY)/zoom;
    const iso=screenToIso(wx,wy); avatar.x=clamp(Math.round(iso.x),0,gridW-1); avatar.y=clamp(Math.round(iso.y),0,gridH-1); draw();
    const b=document.getElementById('bubble'); b.style.left=(px)+'px'; b.style.top=(py)+'px'; b.textContent='ðŸ‘‹'; b.style.display='block'; setTimeout(()=>b.style.display='none',900);
  });

  // zoom
  document.getElementById('zoomIn').onclick=()=>{ const c={x:canvas.width/2,y:canvas.height/2}; zoomAt(c, 1.1); };
  document.getElementById('zoomOut').onclick=()=>{ const c={x:canvas.width/2,y:canvas.height/2}; zoomAt(c, 1/1.1); };
  document.getElementById('zoomReset').onclick=fit;

  function zoomAt(center, factor){
    const prev=zoom; zoom=clamp(zoom*factor, 0.5, 3);
    const scale=zoom/prev;
    offX = center.x - (center.x - offX)*scale;
    offY = center.y - (center.y - offY)*scale;
    draw();
  }

  // chat
  const chat=document.getElementById('chat');
  document.getElementById('send').onclick=()=>{ if(!chat.value.trim()) return; const b=document.getElementById('bubble'); b.textContent=chat.value; b.style.left=(canvas.width/2)+'px'; b.style.top=(canvas.height/2 - 80)+'px'; b.style.display='block'; setTimeout(()=>b.style.display='none',2000); chat.value=''; };
  chat.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); document.getElementById('send').click(); }});

  // init + resize
  window.addEventListener('resize', fit);
  fit();
  </script>
</body>
</html>
