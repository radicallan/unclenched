<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ORACLE PRO – Sensor Channel v1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #04040a;
      --bg-soft: #0a0a16;
      --accent: #7b5cff;
      --accent-soft: rgba(123, 92, 255, 0.2);
      --accent-strong: #cab4ff;
      --text: #f5f5ff;
      --text-soft: #b5b7d0;
      --danger: #ff4f7b;
      --radius-xl: 24px;
      --radius-pill: 999px;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --shadow-soft: 0 16px 40px rgba(0, 0, 0, 0.8);
      --transition-fast: 140ms ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #191940 0, #04040a 60%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }

    .shell {
      width: 100%;
      max-width: 780px;
      background: linear-gradient(140deg, rgba(255, 255, 255, 0.03), transparent);
      border-radius: 30px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 18px 18px 14px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(123, 92, 255, 0.2), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(255, 79, 123, 0.12), transparent 65%);
      mix-blend-mode: screen;
      opacity: 0.8;
      pointer-events: none;
    }

    .shell-inner {
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 14px;
    }

    @media (max-width: 640px) {
      header {
        flex-direction: column;
      }
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 2px;
    }

    .badge {
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.4);
      color: var(--text-soft);
    }

    .badge.accent {
      border-color: var(--accent);
      background: rgba(123, 92, 255, 0.16);
      color: var(--accent-strong);
    }

    h1 {
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-soft);
      max-width: 380px;
    }

    .status-pill {
      font-size: 10px;
      padding: 5px 11px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(6, 34, 26, 0.9);
      color: #9bf4d3;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #9bf4d3;
      box-shadow: 0 0 10px rgba(155, 244, 211, 0.9);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.2fr);
      gap: 14px;
    }

    @media (max-width: 720px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      padding: 14px;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.04), transparent 65%);
    }

    .panel-title {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .big-word-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .pulse-circle {
      width: 180px;
      height: 180px;
      max-width: 70vw;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background:
        radial-gradient(circle at 30% 10%, rgba(255, 255, 255, 0.12), transparent 60%),
        radial-gradient(circle at 50% 100%, rgba(2, 4, 28, 1), #02020b);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
      position: relative;
      overflow: hidden;
      transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
    }

    .pulse-circle::after {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 0% 0%, rgba(123, 92, 255, 0.4), transparent 65%),
        radial-gradient(circle at 100% 100%, rgba(255, 79, 123, 0.3), transparent 55%);
      mix-blend-mode: soft-light;
      opacity: 0.65;
      pointer-events: none;
    }

    .pulse-circle.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(123, 92, 255, 0.5),
        0 18px 45px rgba(0, 0, 0, 0.95);
    }

    .big-word {
      font-size: 26px;
      font-weight: 600;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      text-align: center;
      padding-left: 0.3em; /* account for letter-spacing */
    }

    .big-word-empty {
      font-size: 13px;
      color: var(--text-soft);
      text-align: center;
      padding: 0 16px;
    }

    .mode-hint {
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
    }

    .mode-hint span {
      font-family: "SF Mono", ui-monospace, Menlo, Consolas, monospace;
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(5, 5, 28, 0.9);
    }

    .controls-row {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    button {
      border: none;
      cursor: pointer;
      font: inherit;
    }

    .primary-btn {
      padding: 9px 16px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), #ff4f7b);
      color: white;
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.9);
      transition: transform var(--transition-fast),
        box-shadow var(--transition-fast),
        filter var(--transition-fast),
        opacity var(--transition-fast);
    }

    .primary-btn span.symbol {
      font-size: 13px;
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.04);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 1);
    }

    .primary-btn:active {
      transform: translateY(0);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.9);
    }

    .primary-btn.secondary {
      background: rgba(10, 10, 30, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.85);
      letter-spacing: 0.16em;
    }

    .primary-btn:disabled {
      opacity: 0.7;
      cursor: wait;
    }

    .metrics {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      font-size: 10px;
      color: var(--text-soft);
    }

    .metric-pill {
      border-radius: var(--radius-pill);
      padding: 4px 8px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(6, 7, 28, 0.95);
      display: flex;
      justify-content: space-between;
      gap: 6px;
      align-items: baseline;
    }

    .metric-label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .metric-value {
      font-family: "SF Mono", ui-monospace, Menlo, Consolas, monospace;
    }

    /* History */
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .history-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
    }

    .history-meta {
      font-size: 10px;
      color: rgba(181, 183, 208, 0.9);
    }

    .history-list {
      list-style: none;
      max-height: 260px;
      overflow: auto;
      padding-right: 4px;
      margin-top: 4px;
    }

    .history-empty {
      font-size: 11px;
      color: var(--text-soft);
      opacity: 0.8;
      padding: 2px 0;
    }

    .history-item {
      border-radius: 12px;
      padding: 6px 7px;
      margin-bottom: 3px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      background: rgba(6, 7, 25, 0.96);
    }

    .history-top-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .history-time {
      font-size: 10px;
      font-family: "SF Mono", ui-monospace, Menlo, Consolas, monospace;
      color: rgba(181, 183, 208, 0.85);
      white-space: nowrap;
    }

    .history-word {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text);
    }

    .history-energy {
      font-size: 9px;
      color: rgba(181, 183, 208, 0.85);
      margin-top: 2px;
    }

    footer {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      font-size: 9px;
      color: rgba(181, 183, 208, 0.75);
      flex-wrap: wrap;
    }

    .foot-pill {
      padding: 3px 7px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(5, 6, 26, 0.9);
    }

    .foot-right {
      text-align: right;
      max-width: 260px;
    }

    .foot-right strong {
      color: var(--accent-strong);
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="shell-inner">
      <header>
        <div class="title-block">
          <div class="badge-row">
            <div class="badge accent">ORACLE PRO</div>
            <div class="badge">Sensor Channel v1.0</div>
          </div>
          <h1>Lexical Field Receiver</h1>
          <p class="subtitle">
            Uses device motion + ambient sound as chaotic inputs to select words
            from a fixed bank. Interpretation is up to you.
          </p>
        </div>
        <div class="status-pill" id="session-status">
          <span class="status-dot"></span>
          Idle · waiting to start
        </div>
      </header>

      <main>
        <!-- LEFT: Live word + controls -->
        <section class="panel">
          <div class="panel-title">Live channel</div>

          <div class="big-word-wrap">
            <div class="pulse-circle" id="pulse">
              <div class="big-word-empty" id="big-word-empty">
                Tap <strong>Start session</strong> and keep the device nearby.
              </div>
              <div class="big-word" id="big-word" style="display:none;">---</div>
            </div>

            <div class="mode-hint">
              Word every <span id="interval-label">3s</span> · bank size
              <span id="bank-size">0</span>
            </div>
          </div>

          <div class="controls-row">
            <button class="primary-btn" id="toggle-btn" type="button">
              <span class="symbol">◎</span>
              <span id="toggle-label">Start session</span>
            </button>
          </div>

          <div class="metrics">
            <div class="metric-pill">
              <span class="metric-label">Motion</span>
              <span class="metric-value" id="motion-value">0.00</span>
            </div>
            <div class="metric-pill">
              <span class="metric-label">Rotation</span>
              <span class="metric-value" id="rotation-value">0.00</span>
            </div>
            <div class="metric-pill">
              <span class="metric-label">Audio</span>
              <span class="metric-value" id="audio-value">0.00</span>
            </div>
          </div>
        </section>

        <!-- RIGHT: History -->
        <section class="panel">
          <div class="history-header">
            <div class="history-label">Word stream</div>
            <div class="history-meta" id="history-meta">0 entries · latest —</div>
          </div>
          <ul class="history-list" id="history-list">
            <li class="history-empty" id="history-empty">
              Once the channel is running, each word + a crude “energy” mix from
              the sensors will show here.
            </li>
          </ul>
        </section>
      </main>

      <footer>
        <div class="foot-pill">
          Experimental tool. Sensors just provide noise; meaning is user-generated.
        </div>
        <div class="foot-right">
          If you like the idea of “energy” nudging the noise, treat this
          as a <strong>ritual interface</strong>, not proof.
        </div>
      </footer>
    </div>
  </div>

  <script>
    // -------------------------------
    // WORD BANK – edit this as you like
    // -------------------------------
    const WORD_BANK = [
      "ABOUT","ABOVE","ACCEPT","ACCESS","ACTION","ADAPT","AFTER","AGAIN",
      "AGAINST","ALIGN","ALONE","ALREADY","ALWAYS","ANCHOR","ANSWER","ASK",
      "ATTEND","AWARE","BALANCE","BEGIN","BELIEVE","BELOW","BOUNDARY","BREAK",
      "BRIDGE","CALM","CARE","CHANGE","CHOOSE","CIRCLE","CLARIFY","CLOSE",
      "COMFORT","COMMIT","COMPLETE","CONNECT","CROSS","DECIDE","DEEP","DELAY",
      "DISTANCE","DOUBT","EASY","ECHO","EDGE","EMERGE","EMOTION","ENERGY",
      "ENOUGH","ENTER","EVIDENCE","EXACT","EXPAND","EXPOSE","FAITH","FEAR",
      "FIELD","FOCUS","FOLLOW","FORCE","FORWARD","FRAME","FREQUENCY","GATHER",
      "GENTLE","GROUND","GUIDE","GROW","HABIT","HIDDEN","HOLD","HONEST",
      "IMPACT","INSIDE","INTEND","INVITE","JUDGE","KEEP","KIND","KNOW",
      "LEARN","LEAVE","LIGHT","LIMIT","LISTEN","MEASURE","MEET","MOVE",
      "NEAR","NOISE","NOTICE","OFFER","OPEN","ORDER","OVER","OWN","PAUSE",
      "PATTERN","PEACE","POSSIBLE","POWER","PRESENT","PRESSURE","PROTECT",
      "PULL","PURPOSE","QUESTION","QUIET","RECEIVE","REPEAT","RESIST",
      "RESOLVE","REST","RISK","RITUAL","SAY","SEE","SHIFT","SHOW","SIGNAL",
      "SILENCE","SIMPLE","SPACE","SPEAK","SPIRIT","STAND","STAY","STEP",
      "STILL","STRENGTH","TENSION","THIN","THROUGH","TOWARD","TRUST","TRUTH",
      "UNDER","UNDERSTAND","UNSEEN","UNTIL","VALUE","VOICE","WAIT","WARMTH",
      "WITHIN","WITHOUT","WORTH"
    ];

    const INTERVAL_MS = 3000; // word every 3 seconds

    // UI elements
    const bankSizeEl = document.getElementById("bank-size");
    const intervalLabelEl = document.getElementById("interval-label");
    const bigWordEl = document.getElementById("big-word");
    const bigWordEmptyEl = document.getElementById("big-word-empty");
    const pulseEl = document.getElementById("pulse");
    const toggleBtn = document.getElementById("toggle-btn");
    const toggleLabel = document.getElementById("toggle-label");
    const motionValueEl = document.getElementById("motion-value");
    const rotationValueEl = document.getElementById("rotation-value");
    const audioValueEl = document.getElementById("audio-value");
    const historyListEl = document.getElementById("history-list");
    const historyEmptyEl = document.getElementById("history-empty");
    const historyMetaEl = document.getElementById("history-meta");
    const sessionStatusEl = document.getElementById("session-status");

    bankSizeEl.textContent = WORD_BANK.length.toString();
    intervalLabelEl.textContent = (INTERVAL_MS / 1000).toFixed(0) + "s";

    // Sensor state
    let lastMotionMagnitude = 0;
    let lastRotationMagnitude = 0;
    let lastAudioLevel = 0;

    let motionListenerActive = false;
    let audioStream = null;
    let audioAnalyser = null;
    let audioDataArray = null;

    let running = false;
    let tickTimer = null;
    let history = [];

    function setStatus(text, active) {
      sessionStatusEl.textContent = text;
      if (active) {
        sessionStatusEl.style.background = "rgba(5, 40, 28, 0.9)";
        sessionStatusEl.style.color = "#9bf4d3";
      } else {
        sessionStatusEl.style.background = "rgba(40, 10, 16, 0.9)";
        sessionStatusEl.style.color = "#ffb9c9";
      }
    }

    function updateMetricsDisplay() {
      motionValueEl.textContent = lastMotionMagnitude.toFixed(2);
      rotationValueEl.textContent = lastRotationMagnitude.toFixed(2);
      audioValueEl.textContent = lastAudioLevel.toFixed(2);
    }

    // Motion handler
    function handleDeviceMotion(event) {
      const acc = event.accelerationIncludingGravity || event.acceleration;
      const rot = event.rotationRate;

      if (acc) {
        const ax = acc.x || 0;
        const ay = acc.y || 0;
        const az = acc.z || 0;
        lastMotionMagnitude = Math.sqrt(ax * ax + ay * ay + az * az);
      }

      if (rot) {
        const alpha = rot.alpha || 0;
        const beta = rot.beta || 0;
        const gamma = rot.gamma || 0;
        lastRotationMagnitude = Math.sqrt(alpha * alpha + beta * beta + gamma * gamma) / 100;
      }

      updateMetricsDisplay();
    }

    function startMotionListener() {
      if (motionListenerActive) return;

      function enableListener() {
        window.addEventListener("devicemotion", handleDeviceMotion);
        motionListenerActive = true;
      }

      // iOS permission
      if (typeof DeviceMotionEvent !== "undefined" &&
          typeof DeviceMotionEvent.requestPermission === "function") {
        DeviceMotionEvent.requestPermission()
          .then(state => {
            if (state === "granted") {
              enableListener();
            }
          })
          .catch(() => {
            // ignore – will just not have motion
          });
      } else if (typeof DeviceMotionEvent !== "undefined") {
        enableListener();
      }
    }

    // Audio level via Web Audio
    async function startAudio() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        return;
      }

      try {
        audioStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaStreamSource(audioStream);
        audioAnalyser = audioContext.createAnalyser();
        audioAnalyser.fftSize = 256;
        const bufferLength = audioAnalyser.frequencyBinCount;
        audioDataArray = new Uint8Array(bufferLength);
        source.connect(audioAnalyser);

        function audioLoop() {
          if (!audioAnalyser) return;
          audioAnalyser.getByteTimeDomainData(audioDataArray);
          let sum = 0;
          for (let i = 0; i < audioDataArray.length; i++) {
            const v = (audioDataArray[i] - 128) / 128; // -1..1
            sum += v * v;
          }
          const rms = Math.sqrt(sum / audioDataArray.length); // 0..1-ish
          lastAudioLevel = rms * 5; // scale it a bit
          updateMetricsDisplay();
          requestAnimationFrame(audioLoop);
        }
        audioLoop();
      } catch (err) {
        // mic denied or error; we just won't have audio
      }
    }

    function stopAudio() {
      if (audioStream) {
        audioStream.getTracks().forEach(t => t.stop());
      }
      audioStream = null;
      audioAnalyser = null;
      audioDataArray = null;
    }

    function stopMotion() {
      if (motionListenerActive) {
        window.removeEventListener("devicemotion", handleDeviceMotion);
        motionListenerActive = false;
      }
    }

    // Word selection: mix sensors + time into a pseudo-random index
    function selectWord() {
      const time = Date.now();
      const combo =
        (lastMotionMagnitude * 17.3) +
        (lastRotationMagnitude * 31.7) +
        (lastAudioLevel * 47.9) +
        (time % 1000);

      const raw = Math.abs(Math.floor(combo * 3.14159));
      const idx = WORD_BANK.length > 0 ? raw % WORD_BANK.length : 0;
      return WORD_BANK[idx] || "---";
    }

    function formatTime(date) {
      return date.toLocaleTimeString(undefined, {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
    }

    function renderHistory() {
      historyListEl.innerHTML = "";
      if (history.length === 0) {
        historyListEl.appendChild(historyEmptyEl);
        historyEmptyEl.style.display = "block";
        historyMetaEl.textContent = "0 entries · latest —";
        return;
      }
      historyEmptyEl.style.display = "none";

      history.forEach(entry => {
        const li = document.createElement("li");
        li.className = "history-item";

        const top = document.createElement("div");
        top.className = "history-top-row";

        const w = document.createElement("div");
        w.className = "history-word";
        w.textContent = entry.word;

        const t = document.createElement("time");
        t.className = "history-time";
        t.textContent = entry.timeLabel;

        top.appendChild(w);
        top.appendChild(t);

        const energy = document.createElement("div");
        energy.className = "history-energy";
        energy.textContent =
          `motion ${entry.motion.toFixed(2)} · rotation ${entry.rotation.toFixed(2)} · audio ${entry.audio.toFixed(2)}`;

        li.appendChild(top);
        li.appendChild(energy);
        historyListEl.appendChild(li);
      });

      const latest = history[0];
      historyMetaEl.textContent =
        `${history.length} entries · latest ${latest.timeLabel}`;
    }

    function tick() {
      if (!running) return;
      const word = selectWord();

      bigWordEl.textContent = word;
      bigWordEl.style.display = "block";
      bigWordEmptyEl.style.display = "none";

      const now = new Date();
      history.unshift({
        word,
        time: now,
        timeLabel: formatTime(now),
        motion: lastMotionMagnitude,
        rotation: lastRotationMagnitude,
        audio: lastAudioLevel
      });
      if (history.length > 80) {
        history = history.slice(0, 80);
      }
      renderHistory();
    }

    async function startSession() {
      if (running) return;
      running = true;

      toggleBtn.disabled = true;
      toggleLabel.textContent = "Starting…";
      setStatus("Starting · requesting sensors", true);
      pulseEl.classList.add("active");

      // Start sensor listeners
      startMotionListener();
      await startAudio(); // if this fails, we just have 0 audio

      toggleBtn.disabled = false;
      toggleLabel.textContent = "Stop session";
      toggleBtn.classList.remove("secondary");
      setStatus("Channel running · sensors mixed into word selection", true);

      tick(); // immediate first word
      tickTimer = setInterval(tick, INTERVAL_MS);
    }

    function stopSession() {
      if (!running) return;
      running = false;

      if (tickTimer) {
        clearInterval(tickTimer);
        tickTimer = null;
      }
      stopAudio();
      stopMotion();

      pulseEl.classList.remove("active");
      toggleLabel.textContent = "Start session";
      toggleBtn.classList.add("secondary");
      setStatus("Stopped · sensor listeners released", false);
    }

    toggleBtn.addEventListener("click", () => {
      if (running) {
        stopSession();
      } else {
        startSession();
      }
    });

    // Initial UI state
    toggleBtn.classList.add("secondary");
    setStatus("Idle · waiting to start", false);
    renderHistory();
    updateMetricsDisplay();
  </script>
</body>
</html>

